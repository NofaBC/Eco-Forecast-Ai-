<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EcoForecast AIâ„¢ â€” Event-to-Economy Forecaster</title>
  <meta name="description" content="Forecast the local economic impact of wars, market shocks, weather, regime changes, and new policies on cities and businesses." />
  <style>
    :root {
      --bg:#0b1020; --card:#121a35; --edge:#1c254b;
      --text:#e8ecff; --muted:#aab3d9; --accent:#6ea8fe;
      --good:#35c759; --bad:#ff453a; --warn:#ffd60a;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Arial;background:linear-gradient(180deg,#0b1020,#0a0f1c);color:var(--text)}
    a{color:var(--accent)}
    header{padding:28px 20px;border-bottom:1px solid var(--edge);background:rgba(10,15,28,.6);backdrop-filter:saturate(1.2) blur(8px);position:sticky;top:0;z-index:20}
    .wrap{max-width:1080px;margin:0 auto}
    .flex{display:flex;gap:14px;align-items:center;justify-content:space-between}
    h1{margin:0;font-size:22px;letter-spacing:.3px}
    .tag{display:inline-block;margin-top:8px;padding:4px 10px;border:1px solid #263064;border-radius:999px;color:var(--muted);font-size:12px}
    main{padding:26px 20px}
    .hero{display:grid;grid-template-columns:1.1fr .9fr;gap:20px;margin-bottom:18px}
    .hero-card{background:var(--card);border:1px solid var(--edge);border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .hero h2{margin:0 0 10px}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid #2a3567;color:var(--muted);font-size:12px}
    label{display:block;font-size:13px;color:var(--muted);margin:10px 0 4px}
    input,select,textarea{width:100%;padding:12px 12px;border-radius:12px;border:1px solid #27315f;background:#0e1530;color:var(--text);outline:none}
    textarea{min-height:100px;resize:vertical}
    button{padding:14px 16px;border-radius:12px;border:1px solid #33407a;background:linear-gradient(180deg,#2741b3,#1f2d80);color:white;font-weight:600;cursor:pointer}
    button[disabled]{opacity:.6;cursor:not-allowed}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .chip{border:1px solid #2a3567;background:#0e1530;padding:6px 10px;border-radius:999px;font-size:12px;cursor:pointer;color:white}
    .chip:hover{background:#1a2350}
    .plan-select{margin-top:14px;display:flex;align-items:center;gap:10px}
    .plan-select label{margin:0;font-size:13px;color:var(--muted)}
    .plan-select select{padding:10px 12px;border-radius:10px;background:#0e1530;border:1px solid #2a3567;color:var(--text)}
    .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:8px}
    .kpi .v{font-size:22px;font-weight:700}
    .kpi .u{font-size:12px;color:var(--muted)}
    .drivers li{margin:6px 0}
    .good{color:var(--good)} .bad{color:var(--bad)} .warn{color:var(--warn)}
    @media (max-width:980px){.hero{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="flex">
        <div>
          <h1>EcoForecast AIâ„¢</h1>
          <div class="tag">Business â€¢ Pro â€¢ Enterprise</div>
        </div>
        <nav><a href="#forecast">Forecast</a>&nbsp;Â·&nbsp;<a href="#pricing">Plans</a></nav>
      </div>
    </div>
  </header>

  <main class="wrap" id="forecast">
    <section class="hero">
      <section class="hero-card">
        <h2>Forecast an Impact</h2>
        <p class="pill">Step 1 Â· Describe the event or paste text</p>

        <label for="event">Event / Policy</label>
        <textarea id="event" placeholder="Example: 'U.S. imposes 10% tariff on aluminum; expected start in 60 days.'"></textarea>

        <div class="chips">
          <button class="chip" data-preset="war_escalation">War Escalation</button>
          <button class="chip" data-preset="tariff_steel">10% Steel Tariff</button>
          <button class="chip" data-preset="hurricane_landfall">Hurricane Landfall</button>
          <button class="chip" data-preset="regime_change">Regime Change</button>
          <button class="chip" data-preset="party_shift_us">Party Shift (US)</button>
        </div>

        <div class="row">
          <div>
            <label for="geo">City / Region</label>
            <input id="geo" placeholder="e.g., Phoenix, AZ" />
          </div>
          <div>
            <label for="naics">Industry (NAICS or keyword)</label>
            <input id="naics" placeholder="e.g., 3313 or â€˜Aluminumâ€™" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="horizon">Horizon</label>
            <select id="horizon">
              <option value="short">0â€“3 months</option>
              <option value="medium" selected>3â€“12 months</option>
              <option value="long">12â€“24 months</option>
            </select>
          </div>
          <div>
            <label for="scenario">Scenario</label>
            <select id="scenario">
              <option>Base</option>
              <option>Best Case</option>
              <option>Severe</option>
            </select>
          </div>
        </div>

        <label for="factors">(Optional) Extra factors</label>
        <input id="factors" placeholder="wars, weather alerts, policy changesâ€¦" />

        <!-- ðŸ”¹ Plan Selector -->
        <div class="plan-select">
          <label for="plan">Plan:</label>
          <select id="plan">
            <option value="business">Business</option>
            <option value="pro">Pro</option>
            <option value="enterprise">Enterprise</option>
          </select>
        </div>

        <div style="margin-top:14px;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
          <button id="run">Run Forecast</button>
          <button id="reset" style="background:#0f1630;border:1px solid var(--edge);color:var(--text)">Reset</button>
          <span id="status" style="color:var(--muted)"></span>
        </div>
      </section>

      <section class="hero-card">
        <h2>Results</h2>
        <div id="results" style="min-height:260px">
          <p class="pill">Forecast output will appear here.</p>
          <div class="kpi">
            <div><div class="u">Demand</div><div id="kpiDemand" class="v">â€”</div></div>
            <div><div class="u">Costs</div><div id="kpiCosts" class="v">â€”</div></div>
            <div><div class="u">EBITDA Margin</div><div id="kpiMargin" class="v">â€”</div></div>
          </div>
          <h3 style="margin:14px 0 6px">Top Drivers</h3>
          <ul id="drivers" class="drivers"></ul>
          <p id="conf" class="u" style="margin-top:8px"></p>
        </div>
      </section>
    </section>
  </main>

  <footer class="wrap" style="padding:28px 20px;color:var(--muted);font-size:13px">
    Â© EcoForecast AIâ„¢ â€¢ All rights reserved â€¢ <em>Part of the GovFlow AIâ„¢ family</em>
  </footer>

  <script>
    // ðŸ”¹ Restore plan from localStorage
    const planSel = document.getElementById('plan');
    const savedPlan = localStorage.getItem('plan');
    if (savedPlan) planSel.value = savedPlan;
    planSel.addEventListener('change', e=>{
      localStorage.setItem('plan', e.target.value);
    });

    const $ = id => document.getElementById(id);
    const runBtn = $('run'), statusEl = $('status');

    // Run Forecast handler
    runBtn.addEventListener('click', async () => {
      statusEl.textContent = 'Running forecastâ€¦';
      runBtn.disabled = true;

      const payload = {
        event: $('event').value.trim(),
        geo: $('geo').value.trim(),
        naics: $('naics').value.trim(),
        horizon: $('horizon').value,
        scenario: $('scenario').value,
        extra_factors: $('factors').value.trim(),
        plan: planSel.value
      };

      try {
        const res = await fetch('/api/forecast', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error('API error');
        const data = await res.json();

        $('kpiDemand').textContent = fmtPct(data.demand_pct);
        $('kpiCosts').textContent = fmtPct(data.cost_pct);
        $('kpiMargin').textContent = (data.margin_bps>0?'+':'') + data.margin_bps + ' bps';

        const drivers = $('drivers');
        drivers.innerHTML = '';
        (data.drivers || []).slice(0,10).forEach(d=>{
          const li=document.createElement('li');
          li.textContent='â€¢ '+d.text;
          li.className=d.tone;
          drivers.appendChild(li);
        });
        $('conf').textContent='Confidence: '+Math.round((data.confidence||0)*100)+'%';
        statusEl.textContent='Done.';
      } catch(e){
        statusEl.textContent='Error: '+(e.message||'forecast failed');
      } finally { runBtn.disabled=false; }
    });

    function fmtPct(x){
      if(isNaN(x))return'â€”';
      const sign=x>0?'+':'';
      return sign+Number(x).toFixed(1)+'%';
    }
  </script>
</body>
</html>
