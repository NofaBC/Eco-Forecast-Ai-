<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EcoForecast AIâ„¢ â€“ Economic Impact Intelligence</title>
  <link rel="icon" href="/favicon.ico" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body class="bg-slate-950 text-slate-100 font-sans min-h-screen flex flex-col items-center">
  <header class="py-6 text-center">
    <h1 class="text-3xl font-bold text-indigo-400">EcoForecast AIâ„¢</h1>
    <p class="text-slate-400">Transform global events into business intelligence.</p>
  </header>

  <main class="w-full max-w-5xl bg-slate-900 p-6 rounded-2xl shadow-lg">
    <div class="grid md:grid-cols-2 gap-6">
      <section>
        <h2 class="text-xl font-semibold mb-3">Forecast an Impact</h2>
        <form id="forecastForm" class="space-y-2">
          <input id="event" class="w-full p-2 rounded bg-slate-800 border border-slate-700" placeholder="Describe event or policy..." />
          <input id="geo" class="w-full p-2 rounded bg-slate-800 border border-slate-700" placeholder="City / Region" />
          <input id="naics" class="w-full p-2 rounded bg-slate-800 border border-slate-700" placeholder="Industry / NAICS code" />
          <select id="plan" class="w-full p-2 rounded bg-slate-800 border border-slate-700">
            <option value="business">Business</option>
            <option value="pro">Pro</option>
            <option value="enterprise">Enterprise</option>
          </select>
          <button type="submit" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded mt-2">Run Forecast</button>
        </form>
      </section>

      <section id="results" class="p-4 bg-slate-800 rounded-xl">
        <h2 class="text-lg font-semibold mb-2">Economic Impact Assessment</h2>
        <div id="output" class="text-slate-300">
          <p class="text-slate-400 text-sm">Run a forecast to view results.</p>
        </div>
        <button id="downloadReport" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded mt-4 hidden">
          ðŸ“„ Download PDF
        </button>
      </section>
    </div>
  </main>

  <footer class="text-slate-500 text-sm py-6">
    Â© 2025 EcoForecast AIâ„¢ â€“ Part of the GovFlow AIâ„¢ Family.
  </footer>

  <script>
  const form = document.getElementById("forecastForm");
  const output = document.getElementById("output");
  const downloadBtn = document.getElementById("downloadReport");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    output.innerHTML = "<p class='text-yellow-400'>Generating forecast...</p>";
    const event = document.getElementById("event").value;
    const geo = document.getElementById("geo").value;
    const naics = document.getElementById("naics").value;
    const plan = document.getElementById("plan").value;

    const res = await fetch("/api/forecast", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ event, geo, naics, plan, scenario: "Base" })
    });
    const data = await res.json();

    output.innerHTML = `
      <p><b>Demand:</b> ${data.demand_pct ?? 0}%</p>
      <p><b>Costs:</b> ${data.cost_pct ?? 0}%</p>
      <p><b>EBITDA Margin:</b> ${data.margin_bps ?? 0} bps</p>
      <hr class="my-3 border-slate-600" />
      <h3 class="text-xl font-semibold text-indigo-400">Summary</h3>
      <p class="mt-2">${data.narrative?.summary || "No summary available."}</p>
      <h3 class="text-xl font-semibold text-indigo-400 mt-4">Full Analysis</h3>
      <p class="whitespace-pre-line mt-2">${data.narrative?.full || "No details available."}</p>
    `;

    downloadBtn.classList.remove("hidden");
  });

  downloadBtn.addEventListener("click", () => {
    const reportElement = document.querySelector("#results");
    const opt = {
      margin: 0.5,
      filename: `EcoForecast_Report_${new Date().toISOString().split('T')[0]}.pdf`,
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
    };
    html2pdf().set(opt).from(reportElement).save();
  });
  </script>
</body>
</html>
